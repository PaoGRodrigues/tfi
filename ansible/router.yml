- name: Config raspi as router
  hosts: raspi
  remote_user: pi
  become: yes
  become_user: root

  tasks:
  - name: Install packages
    apt:
      name: 
        - hostapd
        - dnsmasq
        - netfilter-persistent
        - iptables-persistent
      state: present
  # This service is necessary for the Raspberry in order to work as an access point.
  - name: Enable service hostapd and ensure it is not masked
    systemd:
      name: hostapd
      enabled: yes
      masked: no
  # This file contains the config for dhcpcd to configure the Raspberry static IP address.
  - name: Config dhcpd file
    copy:
      src: dhcpcd.conf
      dest: /etc/dhcpcd.conf
      owner: root
      group: netdev
      mode: 0664
      state: present